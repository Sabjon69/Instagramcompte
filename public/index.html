<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="Content-Security-Policy" content="default-src * 'unsafe-inline' 'unsafe-eval' data: blob:;">
  <title>Tri des clients</title>

  <style>
    body { font-family: Arial; padding: 20px; background: #f5f5f5; }
    h1 { text-align: center; }
    table { width: 80%; margin: 20px auto; border-collapse: collapse; background: white; }
    th, td { border: 1px solid #ccc; padding: 8px; }
    th { background: #333; color: white; }
    .controle { text-align: center; margin-bottom: 20px; }
    select, button { padding: 8px; margin: 5px; }

    #chargement {
      display: none;
      text-align: center;
      margin-top: 20px;
    }

    .roue {
      border: 6px solid #f3f3f3;
      border-top: 6px solid #333;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: tourner 1s linear infinite;
      margin: auto;
    }

    @keyframes tourner {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>

<body>

  <!-- üî• V√©rification du token via API -->
  <script>
    const token = localStorage.getItem("token");

    fetch("/secure/check", {
      headers: { "Authorization": token }
    })
    .then(r => {
      if (!r.ok) {
        window.location.href = "/public/login.html";
      }
    });
  </script>

  <h1>Liste des clients tri√©s</h1>

  <div class="controle">
    <label>Trier par :</label>
    <select id="champtri">
      <option value="nom">Nom</option>
      <option value="prenom">Pr√©nom</option>
      <option value="age">√Çge</option>
      <option value="ville">Ville</option>
      <option value="id">ID</option>
    </select>

    <label>Ordre :</label>
    <select id="ordretri">
      <option value="asc">Croissant</option>
      <option value="desc">D√©croissant</option>
    </select>

    <button onclick="chargerclients()">Charger</button>
  </div>

  <table>
    <thead>
      <tr>
        <th>ID</th>
        <th>Nom</th>
        <th>Pr√©nom</th>
        <th>√Çge</th>
      </tr>
    </thead>
    <tbody id="tableclients"></tbody>
  </table>

  <div id="chargement">
    <div class="roue"></div>
    <p>Chargement...</p>
  </div>

  <script>
    async function chargerclients() {

      const token = localStorage.getItem("token");
      if (!token) {
        window.location.href = "/public/login.html";
      }

      const chargement = document.getElementById("chargement");
      const tableclients = document.getElementById("tableclients");

      chargement.style.display = "block";
      tableclients.innerHTML = "";

      await new Promise(attendre => setTimeout(attendre, 300));

      const reponse = await fetch("/public/element.txt"); 
      const texte = await reponse.text();

      const lignes = texte.trim().split("\n");

      const clients = lignes.slice(1).map(ligne => {
        const valeurs = ligne.split(",");
        return {
          id: Number(valeurs[0]),
          nom: valeurs[1],
          prenom: valeurs[2],
          age: Number(valeurs[3]),
        };
      });

      const champ = document.getElementById("champtri").value;
      const ordre = document.getElementById("ordretri").value;

      clients.sort((a, b) => {
        if (a[champ] < b[champ]) return ordre === "asc" ? -1 : 1;
        if (a[champ] > b[champ]) return ordre === "asc" ? 1 : -1;
        return 0;
      });

      clients.forEach(client => {
        tableclients.innerHTML += `
          <tr>
            <td>${client.id}</td>
            <td>${client.nom}</td>
            <td>${client.prenom}</td>
            <td>${client.age}</td>
          </tr>
        `;
      });

      chargement.style.display = "none";
    }
  </script>

</body>
</html>
